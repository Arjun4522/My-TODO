<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Enhanced Calendar To-Do App</title>
  <style>
    * { box-sizing: border-box; }
    
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f8fafc;
      min-height: 100vh;
      color: #334155;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      border: 1px solid #e2e8f0;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      color: #1e293b;
      font-size: 2.25rem;
      font-weight: 600;
      letter-spacing: -0.025em;
    }

    .save-status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 8px 16px;
      background: #10b981;
      color: white;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }

    .save-status.show {
      opacity: 1;
    }

    .save-status.error {
      background: #ef4444;
    }

    .tabs {
      display: flex;
      margin-bottom: 32px;
      border-bottom: 1px solid #e2e8f0;
    }

    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      color: #64748b;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
    }

    .tab.active {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
    }

    .tab:hover {
      color: #3b82f6;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .date-section {
      margin-bottom: 32px;
    }

    #calendar {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      background: white;
      transition: all 0.2s ease;
      outline: none;
      color: #374151;
    }

    #calendar:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .task-input-section {
      margin-bottom: 32px;
    }

    .task-input-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: #f8fafc;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
    }

    #task-title {
      padding: 16px;
      font-size: 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      outline: none;
      transition: all 0.2s ease;
      color: #374151;
      font-weight: 600;
    }

    #task-title:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    #task-body {
      padding: 16px;
      font-size: 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      outline: none;
      transition: all 0.2s ease;
      color: #374151;
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    #task-body:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .add-task-row {
      display: flex;
      justify-content: flex-end;
    }

    #add-task {
      padding: 16px 24px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      white-space: nowrap;
    }

    #add-task:hover {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    #add-task:active {
      transform: translateY(0);
    }

    .task-list-section {
      min-height: 200px;
    }

    .task-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e2e8f0;
    }

    .selected-date {
      font-size: 20px;
      font-weight: 600;
      color: #1e293b;
    }

    .task-count {
      background: #f1f5f9;
      color: #475569;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }

    #todo-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .task-item {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.2s ease;
      animation: slideIn 0.3s ease-out;
    }

    .task-item:hover {
      background: #f1f5f9;
      border-color: #cbd5e0;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .task-content {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .task-text {
      flex: 1;
      transition: all 0.3s ease;
    }

    .task-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .task-description {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.4;
    }

    .task-time {
      font-size: 12px;
      color: #9ca3af;
    }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: #9ca3af;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.6;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .stat-item {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-number {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #1e293b;
    }

    .stat-label {
      font-size: 14px;
      color: #64748b;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Summary Table Styles */
    .summary-table-container {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      margin-bottom: 24px;
    }

    .summary-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    .summary-table th,
    .summary-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
      vertical-align: top;
    }

    .summary-table th {
      background: #f8fafc;
      font-weight: 600;
      color: #374151;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .summary-table tr {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .summary-table tr:hover {
      background: #f8fafc;
    }

    .summary-table tr.expanded {
      background: #f1f5f9;
    }

    .task-summary-title {
      font-weight: 600;
      color: #374151;
      margin-bottom: 4px;
    }

    .task-summary-preview {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.4;
      max-height: 40px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .task-summary-full {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.4;
      margin-top: 8px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      display: none;
    }

    .task-summary-full.expanded {
      display: block;
    }

    .expand-indicator {
      color: #9ca3af;
      font-size: 12px;
      margin-top: 4px;
      font-style: italic;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-completed {
      background: #dcfce7;
      color: #166534;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    .date-badge {
      background: #e0f2fe;
      color: #0c4a6e;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .summary-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .data-controls {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .export-btn, .import-btn {
      padding: 12px 20px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .export-btn:hover, .import-btn:hover {
      background: #059669;
      transform: translateY(-1px);
    }

    .clear-btn {
      padding: 12px 20px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .clear-btn:hover {
      background: #dc2626;
      transform: translateY(-1px);
    }

    #import-file {
      display: none;
    }

    .filter-section {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-select {
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      background: white;
      color: #374151;
      font-size: 14px;
    }

    .search-input {
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      background: white;
      color: #374151;
      font-size: 14px;
      min-width: 200px;
    }

    .search-input:focus, .filter-select:focus {
      border-color: #3b82f6;
      outline: none;
    }

    /* Pagination Styles */
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      padding: 16px 0;
    }

    .pagination-info {
      font-size: 14px;
      color: #6b7280;
    }

    .pagination-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .pagination-btn {
      padding: 8px 12px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      color: #374151;
      transition: all 0.2s ease;
    }

    .pagination-btn:hover:not(:disabled) {
      background: #e2e8f0;
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }

    .page-size-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #6b7280;
    }

    .page-size-select {
      padding: 4px 8px;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 14px;
      background: white;
    }

    /* Edit/Delete buttons in summary */
    .action-buttons {
      display: flex;
      gap: 4px;
    }

    .edit-btn, .delete-btn {
      padding: 4px 8px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .edit-btn {
      background: #3b82f6;
      color: white;
    }

    .edit-btn:hover {
      background: #2563eb;
    }

    .delete-btn {
      background: #ef4444;
      color: white;
    }

    .delete-btn:hover {
      background: #dc2626;
    }

    .task-checkbox {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 2px solid #cbd5e0;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .task-checkbox.completed {
      background: #10b981;
      border-color: #10b981;
    }

    .task-checkbox.completed::after {
      content: '✓';
      color: white;
      font-size: 12px;
      font-weight: bold;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s ease;
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      padding: 32px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      animation: slideInModal 0.3s ease;
    }

    .modal-header {
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: #1e293b;
      margin: 0;
    }

    .modal-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .modal-input {
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      color: #374151;
      outline: none;
      transition: all 0.2s ease;
    }

    .modal-input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .modal-textarea {
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      color: #374151;
      outline: none;
      transition: all 0.2s ease;
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    .modal-textarea:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .modal-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal-btn-primary {
      background: #3b82f6;
      color: white;
    }

    .modal-btn-primary:hover {
      background: #2563eb;
    }

    .modal-btn-secondary {
      background: #f1f5f9;
      color: #64748b;
    }

    .modal-btn-secondary:hover {
      background: #e2e8f0;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInModal {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="save-status" id="save-status"></div>
  
  <div class="container">
    <h1>📅 My Tasks</h1>
    
    <div class="tabs">
      <button class="tab active" onclick="switchTab('daily')">Daily View</button>
      <button class="tab" onclick="switchTab('summary')">All Tasks Summary</button>
    </div>

    <!-- Daily View Tab -->
    <div id="daily-tab" class="tab-content active">
      <div class="date-section">
        <input type="date" id="calendar">
      </div>

      <div class="stats">
        <div class="stat-item">
          <div class="stat-number" id="total-tasks">0</div>
          <div class="stat-label">Total</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="completed-tasks">0</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="remaining-tasks">0</div>
          <div class="stat-label">Remaining</div>
        </div>
      </div>

      <div class="task-input-section">
        <div class="task-input-form">
          <input type="text" id="task-title" placeholder="Task title (required)">
          <textarea id="task-body" placeholder="Task description (optional)"></textarea>
          <div class="add-task-row">
            <button id="add-task">Add Task</button>
          </div>
        </div>
      </div>

      <div class="task-list-section">
        <div class="task-list-header">
          <div class="selected-date" id="selected-date">Today's Tasks</div>
          <div class="task-count" id="task-count">0 tasks</div>
        </div>
        <ul id="todo-list"></ul>
      </div>
    </div>

    <!-- Summary View Tab -->
    <div id="summary-tab" class="tab-content">
      <div class="summary-stats">
        <div class="stat-item">
          <div class="stat-number" id="all-total-tasks">0</div>
          <div class="stat-label">All Tasks</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="all-completed-tasks">0</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="all-pending-tasks">0</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="dates-with-tasks">0</div>
          <div class="stat-label">Active Dates</div>
        </div>
      </div>

      <div class="data-controls">
        <button class="export-btn" onclick="exportData()">Export Data</button>
        <button class="import-btn" onclick="document.getElementById('import-file').click()">Import Data</button>
        <input type="file" id="import-file" accept=".json" onchange="importData(event)">
        <button class="clear-btn" onclick="clearAllData()">Clear All Data</button>
      </div>

      <div class="filter-section">
        <select class="filter-select" id="status-filter" onchange="updateSummaryTable()">
          <option value="all">All Tasks</option>
          <option value="completed">Completed</option>
          <option value="pending">Pending</option>
        </select>
        <input type="text" class="search-input" id="search-input" placeholder="Search tasks..." oninput="updateSummaryTable()">
        <div class="page-size-selector">
          <span>Show:</span>
          <select class="page-size-select" id="page-size-select" onchange="changePageSize()">
            <option value="10">10 per page</option>
            <option value="25" selected>25 per page</option>
            <option value="50">50 per page</option>
            <option value="100">100 per page</option>
          </select>
        </div>
      </div>

      <div class="summary-table-container">
        <table class="summary-table">
          <thead>
            <tr>
              <th style="width: 120px;">Date</th>
              <th>Task</th>
              <th style="width: 100px;">Status</th>
              <th style="width: 100px;">Created</th>
              <th style="width: 120px;">Actions</th>
            </tr>
          </thead>
          <tbody id="summary-table-body">
          </tbody>
        </table>
      </div>

      <div class="pagination-container">
        <div class="pagination-info" id="pagination-info">
          Showing 0-0 of 0 tasks
        </div>
        <div class="pagination-controls" id="pagination-controls">
          <!-- Pagination buttons will be dynamically generated -->
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Task Modal -->
  <div id="edit-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Edit Task</h3>
      </div>
      <form class="modal-form">
        <input type="text" id="edit-title" class="modal-input" placeholder="Task title">
        <textarea id="edit-description" class="modal-textarea" placeholder="Task description (optional)"></textarea>
      </form>
      <div class="modal-actions">
        <button type="button" class="modal-btn modal-btn-secondary" onclick="closeEditModal()">Cancel</button>
        <button type="button" class="modal-btn modal-btn-primary" onclick="saveEditedTask()">Save Changes</button>
      </div>
    </div>
  </div>

  <script>
    class TodoApp {
      constructor() {
        this.calendar = document.getElementById('calendar');
        this.taskTitle = document.getElementById('task-title');
        this.taskBody = document.getElementById('task-body');
        this.addTaskButton = document.getElementById('add-task');
        this.todoList = document.getElementById('todo-list');
        this.selectedDate = document.getElementById('selected-date');
        this.taskCount = document.getElementById('task-count');
        this.totalTasks = document.getElementById('total-tasks');
        this.completedTasks = document.getElementById('completed-tasks');
        this.remainingTasks = document.getElementById('remaining-tasks');
        this.summaryTableBody = document.getElementById('summary-table-body');
        this.saveStatus = document.getElementById('save-status');
        
        // Edit modal elements
        this.editModal = document.getElementById('edit-modal');
        this.editTitle = document.getElementById('edit-title');
        this.editDescription = document.getElementById('edit-description');
        this.currentEditTask = null;
        
        // Pagination properties
        this.currentPage = 1;
        this.pageSize = 25;
        this.filteredTasks = [];
        
        // Initialize tasks object
        this.tasks = {};
        
        this.init();
      }

      async init() {
        // Set default date to today
        this.calendar.valueAsDate = new Date();
        
        // Load data from CSV on startup
        await this.loadDataFromCSV();
        
        // Event listeners
        this.addTaskButton.addEventListener('click', () => this.addTask());
        this.taskTitle.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') this.addTask();
        });
        this.taskBody.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' && e.ctrlKey) this.addTask();
        });
        this.calendar.addEventListener('change', () => this.updateView());
        
        // Modal event listeners
        this.editModal.addEventListener('click', (e) => {
          if (e.target === this.editModal) {
            this.closeEditModal();
          }
        });
        
        // Set up Electron IPC listeners if available
        if (window.electronAPI) {
          window.electronAPI.onRequestSave(() => {
            this.saveDataToCSV();
          });
          
          window.electronAPI.onRequestFinalSave(() => {
            this.saveDataToCSV().then(() => {
              // Data saved, app can close now
            });
          });
        }
        
        // Auto-save every 30 seconds (fallback for browser)
        setInterval(() => this.autoSave(), 30000);
        
        // Save data when page is about to close (browser fallback)
        window.addEventListener('beforeunload', () => this.autoSave());
        
        // Initial view update
        this.updateView();
        this.updateSummaryTable();
      }

      async loadDataFromCSV() {
        try {
          if (window.electronAPI) {
            // Electron environment - use IPC
            const result = await window.electronAPI.loadTasksCSV();
            if (result.success) {
              this.tasks = result.data;
              this.showSaveStatus('Data loaded from CSV', 'success');
            } else {
              console.error('Error loading CSV:', result.error);
              this.tasks = {};
            }
          } else {
            // Browser fallback - use localStorage
            this.loadData();
          }
        } catch (error) {
          console.error('Error loading data from CSV:', error);
          this.tasks = {};
        }
      }

      async saveDataToCSV() {
        try {
          if (window.electronAPI) {
            // Electron environment - use IPC to save CSV
            const result = await window.electronAPI.saveTasksCSV(this.tasks);
            if (result.success) {
              this.showSaveStatus('Data saved to CSV', 'success');
            } else {
              this.showSaveStatus('Error saving data', 'error');
              console.error('Error saving CSV:', result.error);
            }
          } else {
            // Browser fallback - use localStorage
            this.saveData();
            this.showSaveStatus('Data saved locally', 'success');
          }
        } catch (error) {
          console.error('Error saving data to CSV:', error);
          this.showSaveStatus('Error saving data', 'error');
        }
      }

      autoSave() {
        // Only auto-save in browser mode (Electron handles its own save timing)
        if (!window.electronAPI) {
          this.saveData();
        }
      }

      showSaveStatus(message, type = 'success') {
        this.saveStatus.textContent = message;
        this.saveStatus.className = `save-status ${type} show`;
        
        setTimeout(() => {
          this.saveStatus.classList.remove('show');
        }, 3000);
      }

      // Browser fallback methods
      loadData() {
        try {
          const savedData = localStorage.getItem('todoAppData');
          if (savedData) {
            this.tasks = JSON.parse(savedData);
          } else {
            this.tasks = {};
          }
        } catch (error) {
          console.error('Error loading data:', error);
          this.tasks = {};
        }
      }

      saveData() {
        try {
          localStorage.setItem('todoAppData', JSON.stringify(this.tasks));
        } catch (error) {
          console.error('Error saving data:', error);
        }
      }

      async addTask() {
        const dateStr = this.calendar.value;
        const taskTitle = this.taskTitle.value.trim();
        const taskBody = this.taskBody.value.trim();

        if (!dateStr || !taskTitle) return;

        if (!this.tasks[dateStr]) {
          this.tasks[dateStr] = [];
        }

        const task = {
          id: Date.now(),
          title: taskTitle,
          body: taskBody,
          completed: false,
          createdAt: new Date().toLocaleTimeString()
        };

        this.tasks[dateStr].push(task);
        this.taskTitle.value = '';
        this.taskBody.value = '';
        
        // Save immediately when task is added
        await this.saveDataToCSV();
        
        this.updateView();
        this.updateSummaryTable();
      }

      async deleteTask(dateStr, taskId) {
        if (this.tasks[dateStr]) {
          this.tasks[dateStr] = this.tasks[dateStr].filter(task => task.id !== taskId);
          if (this.tasks[dateStr].length === 0) {
            delete this.tasks[dateStr];
          }
          await this.saveDataToCSV();
          this.updateView();
          this.updateSummaryTable();
        }
      }

      async toggleTask(dateStr, taskId) {
        if (this.tasks[dateStr]) {
          const task = this.tasks[dateStr].find(task => task.id === taskId);
          if (task) {
            task.completed = !task.completed;
            await this.saveDataToCSV();
            this.updateView();
            this.updateSummaryTable();
          }
        }
      }

      updateView() {
        const dateStr = this.calendar.value;
        const dateTasks = this.tasks[dateStr] || [];
        
        // Update date display
        const date = new Date(dateStr + 'T00:00:00');
        const today = new Date();
        let dateLabel;
        
        if (date.toDateString() === today.toDateString()) {
          dateLabel = "Today's Tasks";
        } else if (date.toDateString() === new Date(today.getTime() + 86400000).toDateString()) {
          dateLabel = "Tomorrow's Tasks";
        } else {
          dateLabel = date.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          });
        }
        
        this.selectedDate.textContent = dateLabel;
        this.taskCount.textContent = `${dateTasks.length} task${dateTasks.length !== 1 ? 's' : ''}`;
        
        // Update task list (VIEW ONLY - no edit/delete buttons)
        this.todoList.innerHTML = '';
        
        if (dateTasks.length === 0) {
          this.todoList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">📝</div>
              <div>No tasks for this date</div>
              <div style="font-size: 14px; margin-top: 5px;">Add a task above to get started!</div>
            </div>
          `;
        } else {
          dateTasks.forEach(task => {
            const li = document.createElement('li');
            li.className = 'task-item';
            li.innerHTML = `
              <div class="task-content">
                <div class="task-text ${task.completed ? 'completed' : ''}">
                  <div class="task-title">${task.title}</div>
                  ${task.body ? `<div class="task-description">${task.body}</div>` : ''}
                </div>
                <div class="task-time">${task.createdAt}</div>
              </div>
            `;
            this.todoList.appendChild(li);
          });
        }
        
        // Update stats
        const completed = dateTasks.filter(task => task.completed).length;
        const total = dateTasks.length;
        const remaining = total - completed;
        
        this.totalTasks.textContent = total;
        this.completedTasks.textContent = completed;
        this.remainingTasks.textContent = remaining;
      }

      updateSummaryTable() {
        const statusFilter = document.getElementById('status-filter').value;
        const searchQuery = document.getElementById('search-input').value.toLowerCase();
        
        let allTasksCount = 0;
        let completedTasksCount = 0;
        let pendingTasksCount = 0;
        let activeDatesCount = Object.keys(this.tasks).length;
        
        // Collect and filter all tasks
        this.filteredTasks = [];
        
        const sortedDates = Object.keys(this.tasks).sort();
        
        sortedDates.forEach(dateStr => {
          const tasks = this.tasks[dateStr];
          tasks.forEach(task => {
            allTasksCount++;
            
            if (task.completed) {
              completedTasksCount++;
            } else {
              pendingTasksCount++;
            }
            
            // Apply filters
            const matchesStatus = statusFilter === 'all' || 
              (statusFilter === 'completed' && task.completed) ||
              (statusFilter === 'pending' && !task.completed);
            
            const matchesSearch = task.title.toLowerCase().includes(searchQuery) ||
              (task.body && task.body.toLowerCase().includes(searchQuery));
            
            if (matchesStatus && matchesSearch) {
              this.filteredTasks.push({
                ...task,
                dateStr: dateStr
              });
            }
          });
        });
        
        // Reset to first page when filters change
        this.currentPage = 1;
        
        // Render paginated table
        this.renderPaginatedTable();
        this.renderPagination();
        
        // Update summary stats
        document.getElementById('all-total-tasks').textContent = allTasksCount;
        document.getElementById('all-completed-tasks').textContent = completedTasksCount;
        document.getElementById('all-pending-tasks').textContent = pendingTasksCount;
        document.getElementById('dates-with-tasks').textContent = activeDatesCount;
      }

      renderPaginatedTable() {
        const startIndex = (this.currentPage - 1) * this.pageSize;
        const endIndex = startIndex + this.pageSize;
        const paginatedTasks = this.filteredTasks.slice(startIndex, endIndex);
        
        this.summaryTableBody.innerHTML = '';
        
        paginatedTasks.forEach(task => {
          const row = document.createElement('tr');
          const formattedDate = new Date(task.dateStr + 'T00:00:00').toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });
          
          const taskId = `task-${task.dateStr}-${task.id}`;
          const hasBody = task.body && task.body.trim().length > 0;
          
          row.innerHTML = `
            <td><span class="date-badge">${formattedDate}</span></td>
            <td onclick="todoApp.toggleTaskDetails('${taskId}')">
              <div class="task-summary-title">${task.title}</div>
              ${hasBody ? `
                <div class="task-summary-preview" id="preview-${taskId}">${task.body}</div>
                <div class="task-summary-full" id="full-${taskId}">${task.body}</div>
                <div class="expand-indicator" id="indicator-${taskId}">Click to expand</div>
              ` : ''}
            </td>
            <td>
              <div class="task-checkbox ${task.completed ? 'completed' : ''}" 
                   onclick="todoApp.toggleTaskFromSummary('${task.dateStr}', ${task.id})"></div>
            </td>
            <td>${task.createdAt}</td>
            <td>
              <div class="action-buttons">
                <button class="edit-btn" onclick="todoApp.openEditModal('${task.dateStr}', ${task.id})">Edit</button>
                <button class="delete-btn" onclick="todoApp.deleteTaskFromSummary('${task.dateStr}', ${task.id})">Delete</button>
              </div>
            </td>
          `;
          
          this.summaryTableBody.appendChild(row);
        });
        
        // Update pagination info
        const totalTasks = this.filteredTasks.length;
        const startItem = totalTasks === 0 ? 0 : startIndex + 1;
        const endItem = Math.min(endIndex, totalTasks);
        
        document.getElementById('pagination-info').textContent = 
          `Showing ${startItem}-${endItem} of ${totalTasks} tasks`;
      }

      renderPagination() {
        const totalPages = Math.ceil(this.filteredTasks.length / this.pageSize);
        const paginationControls = document.getElementById('pagination-controls');
        
        paginationControls.innerHTML = '';
        
        if (totalPages <= 1) return;
        
        // Previous button
        const prevBtn = document.createElement('button');
        prevBtn.className = 'pagination-btn';
        prevBtn.textContent = '← Previous';
        prevBtn.disabled = this.currentPage === 1;
        prevBtn.onclick = () => this.goToPage(this.currentPage - 1);
        paginationControls.appendChild(prevBtn);
        
        // Page numbers
        const startPage = Math.max(1, this.currentPage - 2);
        const endPage = Math.min(totalPages, this.currentPage + 2);
        
        if (startPage > 1) {
          const firstBtn = document.createElement('button');
          firstBtn.className = 'pagination-btn';
          firstBtn.textContent = '1';
          firstBtn.onclick = () => this.goToPage(1);
          paginationControls.appendChild(firstBtn);
          
          if (startPage > 2) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.padding = '8px';
            ellipsis.style.color = '#9ca3af';
            paginationControls.appendChild(ellipsis);
          }
        }
        
        for (let i = startPage; i <= endPage; i++) {
          const pageBtn = document.createElement('button');
          pageBtn.className = `pagination-btn ${i === this.currentPage ? 'active' : ''}`;
          pageBtn.textContent = i;
          pageBtn.onclick = () => this.goToPage(i);
          paginationControls.appendChild(pageBtn);
        }
        
        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.padding = '8px';
            ellipsis.style.color = '#9ca3af';
            paginationControls.appendChild(ellipsis);
          }
          
          const lastBtn = document.createElement('button');
          lastBtn.className = 'pagination-btn';
          lastBtn.textContent = totalPages;
          lastBtn.onclick = () => this.goToPage(totalPages);
          paginationControls.appendChild(lastBtn);
        }
        
        // Next button
        const nextBtn = document.createElement('button');
        nextBtn.className = 'pagination-btn';
        nextBtn.textContent = 'Next →';
        nextBtn.disabled = this.currentPage === totalPages;
        nextBtn.onclick = () => this.goToPage(this.currentPage + 1);
        paginationControls.appendChild(nextBtn);
      }

      goToPage(page) {
        this.currentPage = page;
        this.renderPaginatedTable();
        this.renderPagination();
      }

      changePageSize() {
        this.pageSize = parseInt(document.getElementById('page-size-select').value);
        this.currentPage = 1;
        this.renderPaginatedTable();
        this.renderPagination();
      }

      toggleTaskDetails(taskId) {
        const preview = document.getElementById(`preview-${taskId}`);
        const full = document.getElementById(`full-${taskId}`);
        const indicator = document.getElementById(`indicator-${taskId}`);
        const row = full ? full.closest('tr') : null;
        
        if (full && preview) {
          const isExpanded = full.classList.contains('expanded');
          
          if (isExpanded) {
            full.classList.remove('expanded');
            preview.style.display = 'block';
            indicator.textContent = 'Click to expand';
            if (row) row.classList.remove('expanded');
          } else {
            full.classList.add('expanded');
            preview.style.display = 'none';
            indicator.textContent = 'Click to collapse';
            if (row) row.classList.add('expanded');
          }
        }
      }

      async toggleTaskFromSummary(dateStr, taskId) {
        await this.toggleTask(dateStr, taskId);
      }

      // New modal-based edit functionality
      openEditModal(dateStr, taskId) {
        if (this.tasks[dateStr]) {
          const task = this.tasks[dateStr].find(task => task.id === taskId);
          if (task) {
            this.currentEditTask = { dateStr, taskId };
            this.editTitle.value = task.title;
            this.editDescription.value = task.body || '';
            this.editModal.classList.add('show');
            this.editTitle.focus();
          }
        }
      }

      closeEditModal() {
        this.editModal.classList.remove('show');
        this.currentEditTask = null;
        this.editTitle.value = '';
        this.editDescription.value = '';
      }

      async saveEditedTask() {
        if (!this.currentEditTask) return;
        
        const newTitle = this.editTitle.value.trim();
        if (!newTitle) return;
        
        const { dateStr, taskId } = this.currentEditTask;
        const task = this.tasks[dateStr].find(task => task.id === taskId);
        
        if (task) {
          task.title = newTitle;
          task.body = this.editDescription.value.trim();
          
          await this.saveDataToCSV();
          this.updateView();
          this.updateSummaryTable();
          this.closeEditModal();
        }
      }

      async deleteTaskFromSummary(dateStr, taskId) {
        if (confirm('Are you sure you want to delete this task?')) {
          await this.deleteTask(dateStr, taskId);
        }
      }

      exportData() {
        const dataStr = JSON.stringify(this.tasks, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'todo-tasks-' + new Date().toISOString().split('T')[0] + '.json';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      async importData(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = async (e) => {
            try {
              const importedTasks = JSON.parse(e.target.result);
              // Merge with existing tasks
              Object.keys(importedTasks).forEach(dateStr => {
                if (!this.tasks[dateStr]) {
                  this.tasks[dateStr] = [];
                }
                // Add unique ID to prevent conflicts
                importedTasks[dateStr].forEach(task => {
                  task.id = Date.now() + Math.random();
                });
                this.tasks[dateStr] = [...this.tasks[dateStr], ...importedTasks[dateStr]];
              });
              await this.saveDataToCSV();
              this.updateView();
              this.updateSummaryTable();
              alert('Data imported successfully!');
            } catch (error) {
              alert('Error importing data. Please check the file format.');
            }
          };
          reader.readAsText(file);
        }
        event.target.value = ''; // Reset file input
      }

      async clearAllData() {
        if (confirm('Are you sure you want to delete all tasks? This action cannot be undone.')) {
          this.tasks = {};
          await this.saveDataToCSV();
          this.updateView();
          this.updateSummaryTable();
        }
      }
    }

    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(tabName + '-tab').classList.add('active');
      
      if (tabName === 'summary') {
        todoApp.updateSummaryTable();
      }
    }

    function exportData() {
      todoApp.exportData();
    }

    async function importData(event) {
      await todoApp.importData(event);
    }

    async function clearAllData() {
      await todoApp.clearAllData();
    }

    function updateSummaryTable() {
      todoApp.updateSummaryTable();
    }

    function changePageSize() {
      todoApp.changePageSize();
    }

    function closeEditModal() {
      todoApp.closeEditModal();
    }

    function saveEditedTask() {
      todoApp.saveEditedTask();
    }

    // Initialize the app
    const todoApp = new TodoApp();
  </script>
</body>
</html>